<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <title>GifTastic</title>
  <style type="text/css">
   button,
    div,
    form,
    input {
      margin: 10px;
    }
    .item{ 
        float: left;
        margin:10px;
    }

    form{
        float: right;
    }

  </style>
</head>

<body>
  <div id="buttons"> </div>

  <form id="character-form", class="form-group col-4" >
    <label for="character-input"><strong>Add a character</strong> </label>
    <input type="text" class="form-control" id="character-input">

    <br>

    <!-- Button triggers new buttons to be added -->
    <input id="submit" type="submit" class="btn btn-info" value="Submit">
 
  </form>

  <div id="gifs-appear-here" class="form-group col-8">
</div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script type="text/javascript">
   //initial array is empty
   var topics = [];


    $(document).on("click", ".character-btn", function() {
       $("#gifs-appear-here").empty();
      var person = $(this).attr("data-name");
      console.log(person);
      var queryURL = "https://api.giphy.com/v1/gifs/search?q=" +
        person + "&api_key=dc6zaTOxFJmzC&limit=10";

      $.ajax({
          url: queryURL,
          method: "GET"
        })
        .then(function(response) {
            console.log(response);
          var results = response.data;

          for (var i = 0; i < results.length; i++) {
            var gifDiv = $("<div class='item'>");

            var rating = results[i].rating;

            var p = $("<p>").text("Rating: " + rating);

            var personImage = $("<img>");
            personImage.attr("src", results[i].images.fixed_height_still.url);
            personImage.attr("class", "preview");
            gifDiv.prepend(personImage);
            gifDiv.prepend(p);
            
            $("#gifs-appear-here").prepend(gifDiv);
          }

          //onclick event on each image to make it a gif
$(document).on("click", ".preview", function() {
    console.log(this);
    $(this).attr("src", results[i].images.fixed_height.url); 
    // gifDiv.prepend(personImage);
});

        });



        
    });



     // Function for displaying movie data
     function renderButtons() {

// Deleting the movies prior to adding new movies
// (this is necessary otherwise you will have repeat buttons)
$("#buttons").empty();

// Looping through the array of movies
for (var i = 0; i < topics.length; i++) {

  // Then dynamicaly generating buttons for each movie in the array
  // This code $("<button>") is all jQuery needs to create the beginning and end tag. (<button></button>)
  var a = $("<button>");
  // Adding a class of movie-btn to our button
  a.addClass("character-btn");
  a.addClass("btn btn-info");
 
  // Adding a data-attribute
  a.attr("data-name", topics[i]);
  // Providing the initial button text
  a.text(topics[i]);
  // Adding the button to the buttons-view div
  $("#buttons").append(a);
}
}


// This function handles events where a submit new character button is clicked
$("#submit").on("click", function(event) {
    console.log("------")
event.preventDefault();
// This line grabs the input from the textbox
var character = $("#character-input").val().trim();

// Adding character from the textbox to our array
topics.push(character);
console.log(character);
console.log(topics);

// Calling renderButtons which handles the processing of our character array
renderButtons();
});
  </script>
</body>

</html>
